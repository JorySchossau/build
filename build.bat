@echo off
REM This script finds and reports where vcvars is for the current machine
REM We assume custom dirs were made into the default niminst output, where 0_1 is 32-bit, 0_2 is 64-bit, 0_3 is 32-bit arm.

REM For usign !var! syntax inside for loops to ref a var instead of %var%, which doesn't work
SETLOCAL ENABLEDELAYEDEXPANSION

SET vcvarsPossibleLocations="C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat" "C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Auxiliary\Build\vcvarsall.bat" "C:\Program Files (x86)\Microsoft Visual Studio\Preview\Professional\VC\Auxiliary\Build\vcvarsall.bat" "C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvarsall.bat"
SET vcvarsLocation=

REM src/%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR% is used to create the format: src/1_3
SET NIMINST_ARCH_DIR=
SET NIMINST_COMPILER_DIR=

REM ###########
REM Determine architecture of current machine
REM ###########
SET wincpu=unknown
SET nimcpu=unknown
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion" /v "BuildLabEx" | %windir%\system32\find /I ".x86fre."   2>&1 >nul && SET "nimcpu=i386"  && SET "wincpu=x86"     && SET "NIMINST_ARCH_DIR=1"
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion" /v "BuildLabEx" | %windir%\system32\find /I ".amd64fre." 2>&1 >nul && SET "nimcpu=amd64" && SET "wincpu=amd64"   && SET "NIMINST_ARCH_DIR=2"
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion" /v "BuildLabEx" | %windir%\system32\find /I ".armfre."   2>&1 >nul && SET "nimcpu=arm"   && SET "wincpu=x86_arm" && SET "NIMINST_ARCH_DIR=3"
ECHO arch is %wincpu%


REM ########
REM Detect Visual Studio CLI Compiler - Loop through all supported versions/vcvarsLocations for vcvars
REM ########
FOR %%x IN (%vcvarsPossibleLocations%) DO (
SET vcvarsLocation=%%x
IF EXIST !vcvarsLocation! GOTO vcvarsfound
)

:trygcc
REM ########
REM Detect GCC
REM ########
for %%X in (gcc.exe) do (set GCC_PATH=%%~$PATH:X)
if defined GCC_PATH (
    SET "NIMINST_COMPILER_DIR=1"
    SET CC=%GCC_PATH%
    SET LINKER=%GCC_PATH%
    SET "COMP_FLAGS=-w -O3"
    SET "LINK_FLAGS="
    SET "FLAG_INCLUDE=-I"
    SET "FLAG_COMPILE_ONLY=-c"
    SET "FLAG_OBJ_NAME=-o"
    SET "FLAG_EXE_NAME=-o"
    SET "OBJ_EXT=o"
    GOTO gccfound
)

REM #######
REM If we made it this far, then no compiler was found
REM #######
SET "ERRORLEVEL=1"
GOTO END

:vcvarsfound
SET "NIMINST_COMPILER_DIR=0"
ECHO preparing windows build environment for %wincpu%
CALL %vcvarsLocation% %wincpu%
SET "CC=cl
SET "LINKER=link
SET "COMP_FLAGS=/w /Ox"
SET "LINK_FLAGS="
SET "FLAG_INCLUDE=/I"
SET "FLAG_COMPILE_ONLY=/c"
SET "FLAG_OBJ_NAME=/Fo"
SET "FLAG_EXE_NAME=/out:"
SET "OBJ_EXT=obj"

:gccfound
REM #############
REM THE FOLLOWING WAS GENERATED BY niminst THEN CUSTOMIZED
REM #############

REM Generated by niminst
SET BIN_DIR=.

if NOT EXIST %BIN_DIR%\nul mkdir %BIN_DIR%

REM call the compiler:

ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)
ECHO %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.%OBJ_EXT%
CALL %CC% %COMP_FLAGS% %FLAG_INCLUDE%src %FLAG_COMPILE_ONLY% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.c %FLAG_OBJ_NAME%src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.%OBJ_EXT% >nul 2>&1
IF ERRORLEVEL 1 (GOTO:END)

ECHO %LINKER% %FLAG_EXE_NAME%%BIN_DIR%\build.exe  src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.%OBJ_EXT% %LINK_FLAGS%
CALL %LINKER% %FLAG_EXE_NAME%%BIN_DIR%\build.exe  src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\build.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_system.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sharedlist.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_locks.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strutils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_parseutils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_math.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_algorithm.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sequtils.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_macros.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_tables.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_hashes.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strformat.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_unicode.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_osproc.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_os.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_times.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_winlean.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_dynlib.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_ospaths.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_strtabs.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_streams.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_cpuinfo.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_cligen.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_parseopt3.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_argcvt.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_typetraits.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_sets.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\cligen_textUt.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_terminal.%OBJ_EXT% src\%NIMINST_COMPILER_DIR%_%NIMINST_ARCH_DIR%\stdlib_colors.%OBJ_EXT% %LINK_FLAGS%


:END
IF ERRORLEVEL 1 (
    ECHO FAILURE
    ECHO.
    ECHO CSource compilation failed. Please check that a c compiler is installed.
    ECHO If Visual Studio or Visual Studio Build Tools, ensure it's in the default location.
    ECHO In the installer, it's called "Desktop development with C++"
    ECHO If using GCC, ensure it's in the system PATH.
    ECHO "I looked in the following locations for Visual Studio's vcvarsall.bat:"
    FOR %%x IN (%vcvarsPossibleLocations%) DO (
        ECHO %%x
)

) ELSE (
    ECHO SUCCESS
)
exit /b %ERRORLEVEL%

